<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vedic Maths Games</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&family=Raleway:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        /* CSS Variables for Theme */
        :root {
            --dark-bg: #120118;
            --primary-purple: #8A2BE2; /* BlueViolet */
            --light-purple: #c58af9;
            --glow-color: rgba(138, 43, 226, 0.75);
            --text-color: #f0f0f0;
            --header-height: 70px;
            --success: #00c853;
            --warning: #ffab00;
            --error: #cf6679;
            --border-color: rgba(138, 43, 226, 0.4);
            --transition: all 0.3s ease;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--dark-bg);
            background-image: linear-gradient(315deg, #1a0226 0%, #000000 74%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-top: var(--header-height);
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(138, 43, 226, 0.1) 0%, rgba(138, 43, 226, 0) 60%);
            animation: rotateGlow 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotateGlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        h1, h2, h3 {
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        
        /* Header & Footer */
        .container-fluid { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }
        header { background: rgba(18, 1, 24, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; height: var(--header-height); }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; color: var(--text-color); text-decoration: none; text-shadow: 0 0 5px var(--glow-color); }
        .logo i { color: var(--primary-purple); margin-right: 0.5rem; }
        .nav-menu { display: flex; list-style-type: none; gap: 2rem; }
        .nav-link { color: var(--text-color); text-decoration: none; }
        .nav-link.active { color: var(--light-purple); font-weight: bold;}
        .hamburger { display: none; cursor: pointer; font-size: 1.5rem; }
        footer { background: rgba(18, 1, 24, 0.9); padding: 2.5rem 0; border-top: 1px solid var(--border-color); color: #ccc; margin-top: 4rem; }
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 2rem; }
        .footer-column { flex: 1; min-width: 200px; }
        .footer-column h3 { color: var(--light-purple); margin-bottom: 1rem; }
        .footer-links { list-style: none; }
        .footer-links li { margin-bottom: 0.75rem; }
        .footer-links a { color: #ccc; text-decoration: none; transition: var(--transition); }
        .footer-links a:hover { color: var(--primary-purple); }

        /* Main Game Container */
        .main-container {
            padding: 4rem 1.5rem;
        }

        .container {
            background: rgba(26, 2, 38, 0.7);
            border: 2px solid var(--primary-purple);
            border-radius: 15px;
            box-shadow: 0 0 30px var(--glow-color);
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            text-align: center;
            backdrop-filter: blur(5px);
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--light-purple), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        /* Tabs & Level Selectors */
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; }
        .tab { padding: 10px 25px; background-color: transparent; border: 1px solid var(--primary-purple); border-radius: 25px; margin: 0 10px 10px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: var(--transition); color: var(--text-color); }
        .tab.active { background: linear-gradient(to bottom, var(--primary-purple), #6a1cb9); color: white; transform: scale(1.05); border-color: var(--primary-purple); }
        .tab:hover:not(.active) { background-color: rgba(138, 43, 226, 0.2); }
        .level-selector { margin-bottom: 20px; display: flex; justify-content: center; flex-wrap: wrap; }
        .level-btn { padding: 8px 20px; margin: 0 8px 8px; border: 1px solid var(--light-purple); background: transparent; color: var(--light-purple); border-radius: 20px; cursor: pointer; transition: var(--transition); font-weight: 600; }
        .level-btn.active { background: var(--light-purple); color: var(--dark-bg); box-shadow: 0 4px 8px rgba(138, 43, 226, 0.3); }
        .level-btn:hover:not(.active) { background-color: rgba(138, 43, 226, 0.1); }
        
        /* Game Content Area */
        .game-container { background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 25px; min-height: 400px; border: 1px solid var(--border-color); position: relative; }
        .game-content { margin-top: 30px; }
        .quiz-question { font-size: 1.8rem; margin-bottom: 25px; color: var(--text-color); font-weight: 600; }
        .quiz-options { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .option { padding: 15px; background: rgba(18, 1, 24, 0.8); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; font-size: 1.2rem; transition: var(--transition); }
        .option:hover { background: rgba(40, 5, 60, 0.8); transform: translateY(-2px); border-color: var(--primary-purple); }
        .option.correct { background: linear-gradient(to bottom, var(--success), #00b34a); color: white; border-color: var(--success); }
        .option.incorrect { background: linear-gradient(to bottom, var(--error), #c2185b); color: white; border-color: var(--error); }
        .next-btn { padding: 12px 30px; background: linear-gradient(to bottom, var(--primary-purple), #6a1cb9); color: white; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: var(--transition); font-weight: 600; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); }
        .next-btn:hover { background: linear-gradient(to bottom, var(--light-purple), var(--primary-purple)); transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5); }
        .score { font-size: 1.2rem; margin-top: 20px; color: var(--text-color); font-weight: 500; }
        .sutra-info { margin-top: 20px; padding: 15px; background: rgba(138, 43, 226, 0.1); border-radius: 10px; font-size: 1rem; line-height: 1.5; color: var(--light-purple); border-left: 4px solid var(--primary-purple); text-align: left;}
        
        /* Memory Game */
        .memory-game { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .memory-card { aspect-ratio: 1 / 1; perspective: 1000px; background-color: transparent; border: none; cursor: pointer; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .memory-card.flipped .memory-card-inner { transform: rotateY(180deg); }
        .front-face, .back-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 10px; text-align: center; padding: 8px; overflow: hidden; }
        .front-face { background: linear-gradient(to bottom, var(--primary-purple), #6a1cb9); color: white; font-size: 2.5rem; }
        .back-face { background: rgba(255, 255, 255, 0.9); color: var(--dark-bg); transform: rotateY(180deg); font-weight: 600; font-size: 0.9rem; }
        .back-face small { font-size: 0.75rem; font-weight: 400; margin-top: 4px; }
        
        /* UI Elements */
        .sound-control { position: fixed; top: 85px; right: 20px; background: rgba(26, 2, 38, 0.7); border: 1px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; }
        .timer-container { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 20px; font-size: 1rem; font-weight: 600; border: 1px solid var(--border-color); display: flex; align-items: center; }
        .timer { margin-left: 8px; color: var(--light-purple); min-width: 50px; text-align: center; }
        .timer.warning { color: var(--warning); }
        .timer.danger { color: var(--error); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .hidden { display: none; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu { position: fixed; left: -100%; top: var(--header-height); flex-direction: column; background: #1a0226; width: 100%; text-align: center; transition: left 0.3s ease; gap: 0; }
            .nav-menu.active { left: 0; }
            .nav-item { border-bottom: 1px solid var(--border-color); }
            .nav-link { display: block; padding: 1.5rem; }
            .hamburger { display: block; }
            .quiz-options { grid-template-columns: 1fr; }
            .memory-game { grid-template-columns: repeat(4, 1fr); }
            h1 { font-size: 2.2rem; }
        }
    </style>
</head>

<body>
    <header>
        <div class="container-fluid nav-container">
            <a href="index.html" class="logo"><i class="fas fa-square-root-alt"></i> Zero Stress Maths</a>
            <div class="hamburger" id="hamburger"><i class="fas fa-bars"></i></div>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="formulas.html" class="nav-link">Formulas</a></li>
                <li class="nav-item"><a href="game.html" class="nav-link active">Games</a></li>
                <li class="nav-item"><a href="calculator.html" class="nav-link">Calculator</a></li>
            </ul>
        </div>
    </header>

    <div class="main-container">
        <div class="sound-control" id="soundToggle" onclick="toggleSound()">
            <span id="soundIcon">ðŸ”Š</span>
        </div>
    
        <div class="container">
            <h1>Vedic Maths Games</h1>
    
            <div class="tabs">
                <button class="tab active" onclick="showGame('quiz')">Quiz Game</button>
                <button class="tab" onclick="showGame('memory')">Memory Game</button>
            </div>
    
            <div class="level-selector">
                <button class="level-btn active" onclick="setLevel('easy')">Easy</button>
                <button class="level-btn" onclick="setLevel('average')">Average</button>
                <button class="level-btn" onclick="setLevel('hard')">Hard</button>
            </div>
    
            <div class="game-container">
                <div class="timer-container">
                    Time: <span id="timer" class="timer">00:00</span>
                </div>
    
                <div id="quiz-game" class="game-content">
                    <div class="quiz-question" id="question">What is 12 Ã— 13?</div>
                    <div class="quiz-options">
                        <div class="option" onclick="checkAnswer(this)">156</div>
                        <div class="option" onclick="checkAnswer(this)">144</div>
                        <div class="option" onclick="checkAnswer(this)">168</div>
                        <div class="option" onclick="checkAnswer(this)">136</div>
                    </div>
                    <button class="next-btn hidden" onclick="nextQuestion()">Next Question</button>
                    <div class="score">Score: <span id="score">0</span></div>
                    <div class="sutra-info" id="sutra-info" style="display: none;"></div>
                </div>
    
                <div id="memory-game" class="game-content hidden">
                    <div class="memory-game" id="memory-cards">
                        </div>
                    <div class="score">Pairs Found: <span id="pairs-found">0</span> / 8</div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container-fluid">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Zero Stress Maths</h3>
                    <p>Ancient mathematical techniques from the Vedas that simplify complex calculations.</p>
                </div>
                <div class="footer-column">
                    <h3>Explore</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="formulas.html">Formulas</a></li>
                        <li><a href="game.html">Games</a></li>
                        <li><a href="calculator.html">Calculator</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Hamburger Menu
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('nav-menu');
        hamburger.addEventListener('click', () => { navMenu.classList.toggle('active'); });

        // --- GAME LOGIC (WITH EXPLANATIONS) ---
        let currentLevel = 'easy';
        let currentGame = 'quiz';
        let score = 0;
        let currentQuestion = 0;
        let flippedCards = [];
        let matchedPairs = 0;
        let soundEnabled = true;
        let audioContext;
        let timerInterval;
        let timeLeft;
        let gameActive = false;
        let lockBoard = false;

        const timeLimits = {
            quiz: { easy: 30, average: 25, hard: 20 },
            memory: { easy: 120, average: 90, hard: 60 }
        };

        function initAudio() { try { audioContext = new(window.AudioContext || window.webkitAudioContext)(); } catch (e) { console.error('Web Audio API is not supported in this browser'); soundEnabled = false; document.getElementById('soundIcon').textContent = 'ðŸ”‡'; } }
        function toggleSound() { soundEnabled = !soundEnabled; document.getElementById('soundIcon').textContent = soundEnabled ? 'ðŸ”Š' : 'ðŸ”‡'; if (soundEnabled) playSound('toggle'); }
        function playSound(type) { if (!soundEnabled || !audioContext) return; const oscillator = audioContext.createOscillator(); const gainNode = audioContext.createGain(); oscillator.connect(gainNode); gainNode.connect(audioContext.destination); switch (type) { case 'correct': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.3); break; case 'incorrect': oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(349.23, audioContext.currentTime); gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.4); break; case 'complete': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3); gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.5); break; case 'flip': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); gainNode.gain.setValueAtTime(0.2, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.2); break; case 'match': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime); oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.1); gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.3); break; case 'toggle': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); gainNode.gain.setValueAtTime(0.2, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.1); break; case 'time-warning': oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(440, audioContext.currentTime); gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5); oscillator.start(); oscillator.stop(audioContext.currentTime + 0.5); break; } }

        function startTimer() {
            clearInterval(timerInterval);
            const timerElement = document.getElementById('timer');
            timeLeft = timeLimits[currentGame][currentLevel];
            updateTimerDisplay();
            gameActive = true;
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 10) { timerElement.classList.add('danger'); timerElement.classList.remove('warning'); if (timeLeft > 0) playSound('time-warning'); } else if (timeLeft <= 30) { timerElement.classList.add('warning'); timerElement.classList.remove('danger'); } else { timerElement.classList.remove('warning', 'danger'); }
                if (timeLeft <= 0) { clearInterval(timerInterval); gameActive = false; handleTimeUp(); }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function handleTimeUp() {
            if (currentGame === 'quiz') {
                const questions = quizQuestions[currentLevel];
                document.getElementById('question').textContent = `Time's up! Your score: ${score}/${questions.length}`;
                document.getElementById('sutra-info').style.display = 'block';
                document.getElementById('sutra-info').textContent = "Try again to improve your time!";
                document.querySelector('#quiz-game .quiz-options').innerHTML = '';
                document.querySelector('#quiz-game .next-btn').textContent = 'Restart Quiz';
                playSound('incorrect');
            } else if (currentGame === 'memory') {
                alert("Time's up! You didn't find all the pairs in time.");
                showGame('memory');
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            gameActive = false;
            document.getElementById('timer').classList.remove('warning', 'danger');
        }

        const quizQuestions = {
            easy: [
                { question: "What is 25 Ã— 25?", options: ["625", "525", "650", "600"], answer: "625", sutra: "Ekadhikena Purvena", explanation: "For numbers ending in 5, multiply the first digit (2) by one more than itself (2+1=3) to get 6. Then, append 25. Result: 625." }, 
                { question: "1000 - 357?", options: ["643", "743", "653", "753"], answer: "643", sutra: "Nikhilam Navatashcaramam Dashatah", explanation: "Subtract all digits from 9 and the last from 10. (9-3)=6, (9-5)=4, (10-7)=3. Result: 643." }, 
                { question: "What is 43 x 11?", options: ["473", "463", "483", "373"], answer: "473", sutra: "Multiplication by 11", explanation: "Write the last digit (3). Add the two digits (4+3=7). Write the first digit (4). Result: 473." }
            ],
            average: [
                { question: "98 x 97?", options: ["9506", "9606", "9504", "9406"], answer: "9506", sutra: "Nikhilam (Base 100)", explanation: "Deficiencies from 100 are 2 and 3. Left part: 98-3=95. Right part: 2x3=06. Result: 9506." }, 
                { question: "32 x 41?", options: ["1312", "1212", "1322", "1412"], answer: "1312", sutra: "Urdhva-Tiryagbhyam", explanation: "Right: 2Ã—1=2. Middle: (3Ã—1)+(2Ã—4)=11 (1, carry 1). Left: 3Ã—4=12. 12+1=13. Result: 1312." }, 
                { question: "103 x 105?", options: ["10815", "10715", "10816", "10915"], answer: "10815", sutra: "Nikhilam (Above Base)", explanation: "Surpluses from 100 are 3 and 5. Left part: 103+5=108. Right part: 3x5=15. Result: 10815." }
            ],
            hard: [
                { question: "123 Ã— 321?", options: ["39483", "39473", "38483", "39583"], answer: "39483", sutra: "Urdhva-Tiryagbhyam (3x3)", explanation: "A 5-step vertical and crosswise multiplication yields the result. It's an extension of the 2x2 method." }, 
                { question: "Square of 998?", options: ["996004", "998004", "996008", "986004"], answer: "996004", sutra: "Yavadunam (Squaring)", explanation: "Deficiency from 1000 is 2. Left part: 998-2=996. Right part: 2Â²=004 (3 digits for base 1000). Result: 996004." }, 
                { question: "Cube of 103?", options: ["1092727", "1092627", "1082727", "1092729"], answer: "1092727", sutra: "Yavadunam (Cubing)", explanation: "Surplus is 3. The formula (Number + 2*surplus) / 3*(surplus)Â² / (surplus)Â³ gives 109 / 27 / 27. Result: 1092727." }
            ]
        };

        const sutras = [ { name: "Ekadhikena Purvena", meaning: "By one more than the previous one" }, { name: "Nikhilam...", meaning: "All from 9 and the last from 10" }, { name: "Urdhva-Tiryagbhyam", meaning: "Vertically and crosswise" }, { name: "Paraavartya Yojayet", meaning: "Transpose and adjust" }, { name: "Shunyam Saamyasamuccaye", meaning: "When the sum is the same, that sum is zero" }, { name: "Anurupye...", meaning: "If one is in ratio, the other is zero" }, { name: "Sankalana...", meaning: "By addition and by subtraction" }, { name: "Puranapuranabyham", meaning: "By the completion or non-completion" } ];

        function initGame() { initAudio(); updateLevelButtons(); showGame(currentGame); }

        function showGame(game) {
            stopTimer();
            document.getElementById('quiz-game').classList.add('hidden');
            document.getElementById('memory-game').classList.add('hidden');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${game}-game`).classList.remove('hidden');
            document.querySelector(`.tab[onclick="showGame('${game}')"]`).classList.add('active');
            currentGame = game;
            if (game === 'quiz') { resetQuiz(); } else { setupMemoryGame(); }
        }

        function setLevel(level) {
            currentLevel = level;
            updateLevelButtons();
            showGame(currentGame);
            playSound('flip');
        }

        function updateLevelButtons() {
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === currentLevel);
            });
        }

        function loadQuestion() {
            const questionData = quizQuestions[currentLevel][currentQuestion];
            const sutraInfo = document.getElementById('sutra-info');
            document.getElementById('question').textContent = questionData.question;
            sutraInfo.style.display = 'none'; // Hide explanation initially
            sutraInfo.innerHTML = ''; // Clear previous explanation
            const options = document.querySelectorAll('#quiz-game .option');
            options.forEach((option, index) => {
                option.textContent = questionData.options[index];
                option.className = 'option';
            });
            document.querySelector('#quiz-game .next-btn').classList.add('hidden');
        }

        function resetQuiz() {
            score = 0;
            currentQuestion = 0;
            document.getElementById('score').textContent = score;
            const optionsContainer = document.querySelector('#quiz-game .quiz-options');
            if(optionsContainer.children.length === 0){
                 optionsContainer.innerHTML = `<div class="option" onclick="checkAnswer(this)"></div><div class="option" onclick="checkAnswer(this)"></div><div class="option" onclick="checkAnswer(this)"></div><div class="option" onclick="checkAnswer(this)"></div>`;
            }
            document.querySelector('#quiz-game .next-btn').textContent = 'Next Question';
            loadQuestion();
            startTimer();
        }

        function checkAnswer(option) {
            if (!gameActive) return;
            const questionData = quizQuestions[currentLevel][currentQuestion];
            const isCorrect = option.textContent === questionData.answer;
            const sutraInfo = document.getElementById('sutra-info');

            if (isCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                option.classList.add('correct');
                playSound('correct');
                sutraInfo.innerHTML = `<strong>Correct!</strong> Sutra: ${questionData.sutra}<br>${questionData.explanation}`;
            } else {
                option.classList.add('incorrect');
                playSound('incorrect');
                sutraInfo.innerHTML = `<strong>Incorrect.</strong> The correct answer is <strong>${questionData.answer}</strong>.<br><strong>Sutra:</strong> ${questionData.sutra}<br>${questionData.explanation}`;
                document.querySelectorAll('#quiz-game .option').forEach(opt => {
                    if(opt.textContent === questionData.answer) opt.classList.add('correct');
                });
            }
            sutraInfo.style.display = 'block';
            document.querySelectorAll('#quiz-game .option').forEach(opt => opt.onclick = null);
            document.querySelector('#quiz-game .next-btn').classList.remove('hidden');
            gameActive = false;
        }

        function nextQuestion() {
            currentQuestion++;
            const questions = quizQuestions[currentLevel];
            if (currentQuestion < questions.length) {
                loadQuestion();
                 document.querySelectorAll('#quiz-game .option').forEach(opt => opt.onclick = function(){ checkAnswer(this); });
                startTimer();
            } else {
                stopTimer();
                document.getElementById('question').textContent = `Quiz Complete! Score: ${score}/${questions.length}`;
                document.getElementById('sutra-info').style.display = 'block';
                document.getElementById('sutra-info').textContent = "Well done!";
                document.querySelector('#quiz-game .quiz-options').innerHTML = '';
                document.querySelector('#quiz-game .next-btn').textContent = 'Restart Quiz';
                currentQuestion++;
                playSound('complete');
            }
        }

        function setupMemoryGame() {
            const memoryCards = document.getElementById('memory-cards');
            memoryCards.innerHTML = '';
            flippedCards = [];
            matchedPairs = 0;
            let gameSutras = shuffleArray([...sutras]).slice(0, 8);
            let cardValues = shuffleArray([...gameSutras, ...gameSutras]);
            cardValues.forEach(value => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.name = value.name;
                card.innerHTML = `<div class="memory-card-inner"><div class="front-face">?</div><div class="back-face">${value.name}<br><small>${value.meaning}</small></div></div>`;
                card.addEventListener('click', flipCard);
                memoryCards.appendChild(card);
            });
            document.getElementById('pairs-found').textContent = `0 / ${gameSutras.length}`;
            startTimer();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; }
            return array;
        }

        function flipCard() {
            if (lockBoard || this.classList.contains('flipped') || !gameActive) return;
            this.classList.add('flipped');
            flippedCards.push(this);
            playSound('flip');
            if (flippedCards.length === 2) checkForMatch();
        }

        function checkForMatch() {
            lockBoard = true;
            const [card1, card2] = flippedCards;
            const isMatch = card1.dataset.name === card2.dataset.name;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            flippedCards.forEach(card => card.removeEventListener('click', flipCard));
            matchedPairs++;
            document.getElementById('pairs-found').textContent = `${matchedPairs} / 8`;
            playSound('match');
            if (matchedPairs === 8) {
                stopTimer();
                playSound('complete');
                setTimeout(() => alert('Congratulations! You found all pairs!'), 500);
            }
            resetBoard();
        }

        function unflipCards() { setTimeout(() => { flippedCards.forEach(card => card.classList.remove('flipped')); resetBoard(); }, 1200); }
        function resetBoard() { [flippedCards, lockBoard] = [[], false]; }

        window.onload = initGame;
    </script>
</body>

</html>